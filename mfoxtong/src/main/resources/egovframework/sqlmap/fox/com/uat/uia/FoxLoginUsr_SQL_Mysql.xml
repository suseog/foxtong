<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<!-- 
	수정일                 수정자                          수정내용
  =========     =======    =================================================
  2011.8.26   	서준식     	 	SSO 로그인을 위한 쿼리 추가
  2011.09.27    서준식              컬럼 변경 SUB_DN 을  CRTFC_DN_VALUE 로 변경
  2011.09.28    서준식              컬럼 변경 entrprsmber_id 을  ENTRPRS_MBER_ID 로 변경
-->
<sqlMap namespace="FoxLoginUsr">

	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="loginVO" type="egovframework.com.cmm.LoginVO"/>

	<!-- 로그인 처리를 위한 resultMap -->
	<resultMap id="login" class="egovframework.com.cmm.LoginVO">
		<result property="mberNm" column="mberNm" columnIndex="1"/>
		<result property="mberEmailAddres" column="mberEmailAddres" columnIndex="2"/>
		<result property="userSe" column="userSe" columnIndex="3"/>
		<result property="orgnztId" column="orgnztId" columnIndex="4"/>
		<result property="uniqId" column="uniqId" columnIndex="5"/>		
		<result property="password" column="password" columnIndex="6"/>	
		<result property="ncnm" column="ncnm" columnIndex="7"/>	
	</resultMap>
	
	<!-- 아이디 찾기를 위한 resultMap -->
	<resultMap id="email" class="egovframework.com.cmm.LoginVO">
		<result property="email" column="email" columnIndex="1"/>
	</resultMap>
	
	<!-- 비밀번호 처리를 위한 resultMap -->
	<resultMap id="password" class="egovframework.com.cmm.LoginVO">
		<result property="password" column="password" columnIndex="1"/>
	</resultMap>
	
	
	<!-- 일반 로그인 -->
	<select id="foxLoginDAO.actionLogin" resultMap="login">
			<![CDATA[
			SELECT mber_email_adres AS mberEmailAddres
			     , mber_nm 		AS mberNm
			     , NCNM 		AS ncnm
			     , '01' 		AS userSe
			     , '-' 			AS orgnztId
			     , esntl_id 	AS uniqId
			     , password 	AS password
			     , MOBLPHON_NO 	AS moblPhonNo
			  FROM COMTNGNRLMBERNEW
			 WHERE 1=1
			   AND mber_email_adres = #mberEmailAddres#
			   AND password = #password#
			   AND mber_sttus = '01'
			]]>
	</select>
	

	<!-- 아이디 찾기 -->
	<!-- 
	<select id="foxLoginDAO.searchId" resultMap="id">
			<![CDATA[
			SELECT mber_id AS id
			  FROM COMTNGNRLMBER
			 WHERE mber_nm = #name#
			   AND mber_email_adres = #email#
			   AND mber_sttus = 'P'
			]]>
	</select>
	 -->
	<select id="foxLoginDAO.searchId" resultMap="email">
			<![CDATA[
			SELECT mber_email_adres AS email
			  FROM COMTNGNRLMBER
			 WHERE 1=1
			   AND MOBLPHON_NO =  #moblphonNo# 
			   AND mber_sttus = '01'
			]]>
	</select>
	
	<!-- 비밀번호 찾기 -->
	<select id="foxLoginDAO.searchPassword" resultMap="password">
		<!-- 일반회원 -->
			<![CDATA[
			SELECT password AS password
			  FROM COMTNGNRLMBER
			 WHERE mber_id = #id#
			   AND mber_nm = #name#
			   AND mber_email_adres = #email#
			   AND password_hint = #passwordHint#
			   AND password_cnsr = #passwordCnsr#
			   AND mber_sttus = 'P'
			]]>
	</select>
	
	<!-- 변경된 비밀번호를 저장 -->
	<update id="foxLoginDAO.updatePassword">
			<![CDATA[
			UPDATE COMTNGNRLMBER
			   SET password = #password#
			 WHERE 1=1
			   AND mber_email_adres = #email#
   			   AND MOBLPHON_NO =  #moblphonNo#  
			]]>
	</update>
</sqlMap>
